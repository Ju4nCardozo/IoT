#include <Wire.h>
#include <AP3216_WE.h>
#include <ClosedCube_HDC1080.h>
#include <SoftwareSerial.h>
#include <TinyGPS.h>

AP3216_WE myAP3216 = AP3216_WE();
ClosedCube_HDC1080 sensor;

SoftwareSerial ss(2,0);
TinyGPS gps;

char dato=' ';

void setup() {

  Serial.begin(115200);
  ss.begin(9600);
  Wire.begin();
  myAP3216.init();
  myAP3216.setMode(AP3216_ALS);
  myAP3216.setLuxRange(RANGE_20661);
  sensor.begin(0x40);
}

void loop() {
  // put your main code here, to run repeatedly:
  smartdelay(15);
  TempandHumidity();
  Lux();
}

void smartdelay(){

  unsigned long start = millis();
    do 
    {
        while(ss.available())
      {
        int c = ss.read();
        //Serial.print(c);
        if(gps.encode(c))
        {
  
        }
      }
    } while (millis() - start < 2000);
    float flat, flon;
    unsigned long fix_age;
    gps.f_get_position(&flat, &flon);
    float falt = gps.f_altitude();
    Serial.print("Coordenadas (DD): "); 
    Serial.print(flat,5); 
    Serial.print(", "); 
    Serial.println(flon,5);
    Serial.print("Altitud: ");
    Serial.println(falt,5);
  
}

void TempandHumidity(){

  double temperatura = 0;
  double humedad = 0;

  for(int i=0;i<20;i++){
    temperatura = temperatura + sensor.readTemperature();
    humedad = humedad + sensor.readHumidity();
  }
  
  Serial.print("Temperatura = ");
  Serial.print(temperatura/20);
  Serial.print(" Â°C Humedad ");
  Serial.print(humedad/20);
  Serial.println("%");
  smartdelay(0);
  
}

void Lux(){

  double Lux = 0;
  for(int i=0;i<20;i++){
    Lux = Lux + myAP3216.getAmbientLight();
  }
  Serial.print("Lux: "); Serial.println(Lux/20);
  smartdelay(0);
}
